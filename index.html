<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Teste Document PiP</title>
<style>
body{
  background:#0f172a;
  color:white;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  font-family:Arial;
}
button{
  padding:12px 20px;
  border:none;
  border-radius:12px;
  cursor:pointer;
  font-weight:bold;
}
</style>
</head>
<body>

<button id="start">Abrir Painel</button>

<video id="video" autoplay muted playsinline style="display:none"></video>

<script>
const btn = document.getElementById("start");
const video = document.getElementById("video");

btn.addEventListener("click", async () => {

  // Criar canvas animado (vídeo falso)
  const canvas = document.createElement("canvas");
  canvas.width = 640;
  canvas.height = 360;
  const ctx = canvas.getContext("2d");

  let t = 0;
  function draw(){
    ctx.fillStyle = "#111827";
    ctx.fillRect(0,0,canvas.width,canvas.height);

    ctx.fillStyle = "#22c55e";
    ctx.font = "40px Arial";
    ctx.fillText("Ligação Ativa", 180, 150);

    ctx.fillStyle = "white";
    ctx.font = "20px Arial";
    ctx.fillText("Tempo: " + Math.floor(t/60) + "s", 260, 200);

    t++;
    requestAnimationFrame(draw);
  }
  draw();

  const stream = canvas.captureStream(30);
  video.srcObject = stream;

  if (!("documentPictureInPicture" in window)) {
    alert("API não suportada nesse navegador.");
    return;
  }

  const pipWindow = await documentPictureInPicture.requestWindow({
    width: 360,
    height: 240
  });

  // Move vídeo para janela flutuante
  pipWindow.document.body.style.margin = "0";
  pipWindow.document.body.style.background = "black";
  video.style.display = "block";
  video.style.width = "100%";
  video.style.height = "100%";

  pipWindow.document.body.appendChild(video);

  pipWindow.addEventListener("pagehide", () => {
    document.body.appendChild(video);
  });

});
</script>

</body>
</html>