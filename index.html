<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Painel Invisível</title>
</head>
<body>

<script>
let popup = null;
let fakeStream = null;

// Cria vídeo vazio
function createSilentStream() {
    const ctx = new AudioContext();
    const oscillator = ctx.createOscillator();
    const dst = oscillator.connect(ctx.createMediaStreamDestination());
    oscillator.start();

    fakeStream = dst.stream;
}

// Abre popup
function openPopup() {
    if (!popup || popup.closed) {
        popup = window.open("", "painel", "width=400,height=600");

        if (popup) {
            popup.document.write(`
                <h2>Painel de Controle</h2>
                <button onclick="window.close()">Fechar</button>
            `);
        }
    }
}

// Fecha popup
function closePopup() {
    if (popup && !popup.closed) {
        popup.close();
    }
}

// Listener automático de troca de aba
document.addEventListener("visibilitychange", () => {
    if (document.visibilityState === "visible") {
        openPopup();
    } else {
        closePopup();
    }
});

// Inicializa stream silenciosa automaticamente
createSilentStream();
</script>

</body>
</html>