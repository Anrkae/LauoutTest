<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Auto Doc PiP</title>
<style>
body{
  margin:0;
  background:#0f172a;
  color:white;
  font-family:Arial;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}
</style>
</head>
<body>

<h2>Troque de aba depois do primeiro clique üòâ</h2>

<video id="hiddenVideo" autoplay muted playsinline width="1" height="1"
style="position:absolute;left:-9999px;"></video>

<script>
let pipWindow = null;
let armed = false;
const video = document.getElementById("hiddenVideo");

/* ---------- 1Ô∏è‚É£ Ativa sistema no primeiro clique em qualquer lugar ---------- */
document.addEventListener("pointerdown", async () => {

  if (armed) return;

  // cria m√≠dia invis√≠vel 1x1
  const canvas = document.createElement("canvas");
  canvas.width = 1;
  canvas.height = 1;

  const ctx = canvas.getContext("2d");

  function keepAlive(){
    ctx.fillRect(0,0,1,1);
    requestAnimationFrame(keepAlive);
  }
  keepAlive();

  const stream = canvas.captureStream(1);
  video.srcObject = stream;

  armed = true;
  console.log("Sistema armado.");
}, { once: true });



/* ---------- 2Ô∏è‚É£ Fun√ß√£o abrir PiP ---------- */
async function openPiP(){

  if (!armed) return;
  if (pipWindow) return;
  if (!("documentPictureInPicture" in window)) return;

  pipWindow = await documentPictureInPicture.requestWindow({
    width: 300,
    height: 180
  });

  pipWindow.document.body.innerHTML = `
    <style>
      body{
        margin:0;
        background:#111827;
        color:white;
        font-family:Arial;
        display:flex;
        justify-content:center;
        align-items:center;
      }
    </style>
    Liga√ß√£o ativa
  `;

  pipWindow.addEventListener("pagehide", () => {
    pipWindow = null;
  });
}



/* ---------- 3Ô∏è‚É£ Fun√ß√£o fechar PiP ---------- */
function closePiP(){
  if (pipWindow){
    pipWindow.close();
    pipWindow = null;
  }
}



/* ---------- 4Ô∏è‚É£ Listener autom√°tico troca de aba ---------- */
document.addEventListener("visibilitychange", () => {

  if (!armed) return;

  if (document.hidden){
    openPiP();
  } else {
    closePiP();
  }
});
</script>

</body>
</html>